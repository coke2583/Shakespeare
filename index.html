<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Shakespeare Reader</title>

  <!-- Inlined favicon to avoid 404 requests -->
  <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/5cAAwMCAKP3IboAAAAASUVORK5CYII="/>

  <style>
    body{
      font-family:Georgia,serif;
      line-height:1.5;
      margin:1rem;
      max-width:45rem;
      background:#000;
      color:#fff;
    }
    select{font-size:1rem;margin-bottom:1rem}
    #viewer{white-space:normal}
  </style>
</head>
<body>
  <h1>Shakespeare Reader</h1>
  <label>Play: <select id="picker"></select></label>
  <button id="loadBtn">Load</button>
  <div id="viewer">Loading…</div>

  <script>
    /* -------------------- file list -------------------- */
    const plays = [
      "alls-well-that-ends-well_TEIsimple_FolgerShakespeare.xml",
      "a-midsummer-nights-dream_TEIsimple_FolgerShakespeare.xml",
      "antony-and-cleopatra_TEIsimple_FolgerShakespeare.xml",
      "as-you-like-it_TEIsimple_FolgerShakespeare.xml",
      "coriolanus_TEIsimple_FolgerShakespeare.xml",
      "cymbeline_TEIsimple_FolgerShakespeare.xml",
      "hamlet_TEIsimple_FolgerShakespeare.xml",
      "henry-iv-part-1_TEIsimple_FolgerShakespeare.xml",
      "henry-iv-part-2_TEIsimple_FolgerShakespeare.xml",
      "henry-v_TEIsimple_FolgerShakespeare.xml",
      "henry-viii_TEIsimple_FolgerShakespeare.xml",
      "henry-vi-part-1_TEIsimple_FolgerShakespeare.xml",
      "henry-vi-part-2_TEIsimple_FolgerShakespeare.xml",
      "henry-vi-part-3_TEIsimple_FolgerShakespeare.xml",
      "julius-caesar_TEIsimple_FolgerShakespeare.xml",
      "king-john_TEIsimple_FolgerShakespeare.xml",
      "king-lear_TEIsimple_FolgerShakespeare.xml",
      "loves-labors-lost_TEIsimple_FolgerShakespeare.xml",
      "macbeth_TEIsimple_FolgerShakespeare.xml",
      "measure-for-measure_TEIsimple_FolgerShakespeare.xml",
      "much-ado-about-nothing_TEIsimple_FolgerShakespeare.xml",
      "othello_TEIsimple_FolgerShakespeare.xml",
      "pericles_TEIsimple_FolgerShakespeare.xml",
      "richard-ii_TEIsimple_FolgerShakespeare.xml",
      "richard-iii_TEIsimple_FolgerShakespeare.xml",
      "romeo-and-juliet_TEIsimple_FolgerShakespeare.xml",
      "the-comedy-of-errors_TEIsimple_FolgerShakespeare.xml",
      "the-merchant-of-venice_TEIsimple_FolgerShakespeare.xml",
      "the-merry-wives-of-windsor_TEIsimple_FolgerShakespeare.xml",
      "the-taming-of-the-shrew_TEIsimple_FolgerShakespeare.xml",
      "the-tempest_TEIsimple_FolgerShakespeare.xml",
      "the-two-gentlemen-of-verona_TEIsimple_FolgerShakespeare.xml",
      "the-winters-tale_TEIsimple_FolgerShakespeare.xml",
      "timon-of-athens_TEIsimple_FolgerShakespeare.xml",
      "titus-andronicus_TEIsimple_FolgerShakespeare.xml",
      "troilus-and-cressida_TEIsimple_FolgerShakespeare.xml",
      "twelfth-night_TEIsimple_FolgerShakespeare.xml"
    ];

    /* ---------------- dropdown ------------------------- */
    const picker = document.getElementById("picker");
    plays.forEach(f => {
      const o = document.createElement("option");
      o.value = f;
      o.textContent = f
        .replace(/_TEIsimple_FolgerShakespeare\.xml$/,"")
        .replace(/-/g," ")
        .replace(/\b\w/g,c=>c.toUpperCase());
      picker.appendChild(o);
    });

    /* --------------- loader ---------------------------- */
    const parser = new DOMParser();

    function teiToHtml(node){
      if(!node) return "";
      let out="";
      node.childNodes.forEach(ch=>{
        if(ch.nodeType===Node.TEXT_NODE){
          out += ch.nodeValue.trim();
        } else {
          switch(ch.nodeName){
            case "w":
            case "pc":
              out += ch.textContent;
              break;
            case "c":
              out += " ";
              break;
            case "lb":
              out += "<br>";
              break;
            case "l":
              out += teiToHtml(ch)+"<br>";
              break;
            case "p":
              out += teiToHtml(ch)+"<br><br>";
              break;
            case "speaker":
              out += "<strong>"+teiToHtml(ch)+"</strong> ";
              break;
            case "stage":
              out += "<em>"+teiToHtml(ch)+"</em>";
              break;
            case "head":
              out += "<h3>"+teiToHtml(ch)+"</h3>";
              break;
            case "sp":
              out += "<p>"+teiToHtml(ch)+"</p>";
              break;
            default:
              out += teiToHtml(ch);
          }
        }
      });
      return out;
    }

    async function loadPlay(file){
      const url = `XML/${file}`;
      console.log("Fetching:", url);

      let viewer = document.getElementById("viewer");
      if(!viewer){
        viewer = document.createElement("div");
        viewer.id = "viewer";
        document.body.appendChild(viewer);
      }
      viewer.textContent = "Loading…";

      try{
        const xmlText = await fetch(url).then(r=>r.text());
        const xmlDoc  = parser.parseFromString(xmlText, "application/xml");
        const body    = xmlDoc.querySelector("body");
        viewer.innerHTML = body ? teiToHtml(body) : xmlText;
      }catch(e){
        viewer.textContent = `❌ ${e}`;
        console.error(e);
      }
    }

    document.getElementById("loadBtn").addEventListener("click", () => loadPlay(picker.value));
    loadPlay(plays[0]);                 // first load
  </script>
</body>
</html>
